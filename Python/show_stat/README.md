# 脚本说明
* 这个脚本必须要指定一个元数据节点
* 会根据指定的元数据节点里面的clustermgr/计算节点/存储节点/元数据节点的节点信息获取对应机器及节点进程的资源占用情况，并产生输出文件到指定目录下
```
optional arguments:
  -h, --help            show this help message and exit
  --meta META           meta节点信息，如192.168.0.1:3306
  --output OUTPUT       输出结果的目录, 默认./show_stat
  --interval INTERVAL   每次检查间隔的时间, 默认10s
  --delimiter DELIMITER
                        每个值之前的分割符， 默认"|"
  --disk_device DISK_DEVICE
                        硬盘盘符，超过1个盘符时用逗号隔开, 默认"nvme0n1,nvme1n1"
  --runtime RUNTIME     该脚本的运行时间，以秒记，默认为0则不限制
```
* 产生七个子进程
  * 每个子进程会根据对应的机器数量或者节点进程数量创建子线程通过linux系统命令查询其资源占用情况
  * 并写入到指定目录下的对应文件里
* 以下是输出的七个文件示例
  * 其中 cpu.log, disk.lo,  mem.log监控机器占用的总资源
  * 另外四个log文件为对应组件的所有节点进程占用的资源
```
[kunlun@klustron-test5 benchmarksql-pg]$ python3 show_stat.py --meta 192.168.0.19:59301 --output ./show_stat --runtime 15
[kunlun@klustron-test5 benchmarksql-pg]$ cd show_stat/
[kunlun@klustron-test5 show_stat]$ ls
cluster_mgr.log  cpu.log  disk.log  mem.log  metadata.log  server_node.log  storage_node.log
[kunlun@klustron-test5 show_stat]$ cat cluster_mgr.log
=======================================================
||        - ||          192.168.0.12:59011           ||
=======================================================
||     time ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||
-------------------------------------------------------
|| 11:39:41 ||    0.7 |    0.1 |     0.00 |     0.52 ||
|| 11:39:51 ||    0.7 |    0.1 |     0.00 |     0.52 ||
[kunlun@klustron-test5 show_stat]$ cat cpu.log
==============================================================================================
||        - ||  192.168.0.12    ||  192.168.0.19    ||  192.168.0.13    ||  192.168.0.14    ||
==============================================================================================
||     time || %iowait |  %idle || %iowait |  %idle || %iowait |  %idle || %iowait |  %idle ||
----------------------------------------------------------------------------------------------
|| 11:39:40 ||    0.11 |  94.72 ||    0.62 |  96.92 ||    0.06 |  86.06 ||    0.12 |  98.00 ||
|| 11:39:51 ||    0.11 |  94.72 ||    0.62 |  96.92 ||    0.06 |  86.06 ||    0.12 |  98.00 ||
[kunlun@klustron-test5 show_stat]$ cat disk.log
====================================================================================================================================================================
||        - |           - ||         192.168.0.12           ||         192.168.0.19           ||         192.168.0.13           ||         192.168.0.14           ||
====================================================================================================================================================================
||     time | device_name ||      tps |   read/s |   wrtn/s ||      tps |   read/s |   wrtn/s ||      tps |   read/s |   wrtn/s ||      tps |   read/s |   wrtn/s ||
--------------------------------------------------------------------------------------------------------------------------------------------------------------------
|| 11:39:41 |     nvme0n1 ||   304.24 |    21.58 |  5037.37 ||    24.63 |   537.74 |   133.58 ||    53.56 |  1318.35 |   307.87 ||    71.44 |    28.35 |   581.83 ||
|| 11:39:41 |     nvme1n1 ||   401.55 |   720.13 |  4493.41 ||   370.22 |  2547.07 |  2722.02 ||   285.79 |  2329.90 |  2203.03 ||   134.38 |   369.51 |  1407.64 ||
|| 11:39:51 |     nvme0n1 ||   304.24 |    21.58 |  5037.32 ||    24.63 |   537.73 |   133.58 ||    53.56 |  1318.34 |   307.88 ||    71.44 |    28.35 |   581.83 ||
|| 11:39:51 |     nvme1n1 ||   401.54 |   720.12 |  4493.38 ||   370.22 |  2547.05 |  2722.24 ||   285.79 |  2329.88 |  2203.12 ||   134.39 |   369.50 |  1407.75 ||
[kunlun@klustron-test5 show_stat]$ cat mem.log
==================================================================================================================================================================
||        - ||           192.168.0.12            ||           192.168.0.19            ||           192.168.0.13            ||           192.168.0.14            ||
==================================================================================================================================================================
||     time || mem-to | mem-us | swa-to | swa-us || mem-to | mem-us | swa-to | swa-us || mem-to | mem-us | swa-to | swa-us || mem-to | mem-us | swa-to | swa-us ||
------------------------------------------------------------------------------------------------------------------------------------------------------------------
|| 11:39:40 ||  125Gi |   36Gi |  2.0Gi |  478Mi ||  124Gi |   15Gi |   31Gi |   16Mi ||  125Gi |   73Gi |  2.0Gi |   34Mi ||  125Gi |   37Gi |  2.0Gi |     0B ||
|| 11:39:51 ||  125Gi |   35Gi |  2.0Gi |  478Mi ||  124Gi |   15Gi |   31Gi |   16Mi ||  125Gi |   73Gi |  2.0Gi |   34Mi ||  125Gi |   37Gi |  2.0Gi |     0B ||
[kunlun@klustron-test5 show_stat]$ cat metadata.log
=======================================================
||        - ||          192.168.0.19:59301           ||
=======================================================
||     time ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||
-------------------------------------------------------
|| 11:39:41 ||    1.6 |    0.7 |  2464708 |     0.01 ||
|| 11:39:51 ||    1.6 |    0.7 |  2464708 |     0.01 ||
[kunlun@klustron-test5 show_stat]$ cat server_node.log
=======================================================
||        - ||          192.168.0.13:58881           ||
=======================================================
||     time ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||
-------------------------------------------------------
|| 11:39:41 ||    0.0 |    7.2 |     0.00 |     0.57 ||
|| 11:39:52 ||    0.0 |    7.2 |     0.00 |     0.57 ||
[kunlun@klustron-test5 show_stat]$ cat storage_node.log
=========================================================================================================================================
||        - ||          192.168.0.12:56661           ||          192.168.0.13:56661           ||          192.168.0.14:56661           ||
=========================================================================================================================================
||     time ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||   %cpu |   %mem |  kB_rd/s |  kB_wr/s ||
-----------------------------------------------------------------------------------------------------------------------------------------
|| 11:39:41 ||   39.1 |   26.2 |     0.02 |   142.93 ||   41.7 |   26.4 |     0.03 |   145.03 ||   42.9 |   27.6 |     0.02 |   155.04 ||
|| 11:39:52 ||   39.2 |   26.2 |     0.02 |   143.03 ||   41.7 |   26.4 |     0.03 |   145.11 ||   42.9 |   27.7 |     0.02 |   155.21 ||
```
